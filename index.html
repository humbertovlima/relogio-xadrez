<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#ffffff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Relógio de Xadrez</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React e Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    * {
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      user-select: none;
      -webkit-user-select: none;
    }
    
    #root {
      width: 100vw;
      height: 100vh;
    }
    
    /* Ajustes responsivos para telas pequenas */
    @media (max-height: 500px) {
      .texto-titulo { font-size: 1.25rem !important; }
      .texto-subtitulo { font-size: 0.7rem !important; }
      .texto-categoria { font-size: 0.8rem !important; }
      .botao-tempo { padding: 0.4rem 1rem !important; font-size: 0.8rem !important; }
      .botao-iniciar { padding: 0.5rem 1.5rem !important; font-size: 0.9rem !important; }
      .timer-texto { font-size: 3.5rem !important; }
      .timer-label { font-size: 0.6rem !important; }
      .botao-controle { padding: 0.4rem 1rem !important; font-size: 0.75rem !important; }
      .logo-svg { width: 24px !important; height: 24px !important; }
      .botao-redondo { width: 3rem !important; height: 3rem !important; }
      .botao-redondo svg { width: 18px !important; height: 18px !important; }
    }
    
    @media (min-height: 501px) and (max-height: 700px) {
      .texto-titulo { font-size: 1.5rem !important; }
      .texto-subtitulo { font-size: 0.8rem !important; }
      .texto-categoria { font-size: 0.9rem !important; }
      .botao-tempo { padding: 0.5rem 1.25rem !important; font-size: 0.85rem !important; }
      .botao-iniciar { padding: 0.6rem 2rem !important; font-size: 1rem !important; }
      .timer-texto { font-size: 4.5rem !important; }
      .timer-label { font-size: 0.7rem !important; }
      .botao-controle { padding: 0.5rem 1.25rem !important; font-size: 0.85rem !important; }
      .logo-svg { width: 32px !important; height: 32px !important; }
      .botao-redondo { width: 3.5rem !important; height: 3.5rem !important; }
      .botao-redondo svg { width: 20px !important; height: 20px !important; }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">


function ChessClock() {
  const [incrementEnabled, setIncrementEnabled] = useState(false);
  const [selectedTime, setSelectedTime] = useState(null);
  const [selectedIncrement, setSelectedIncrement] = useState(null);
  const [gameStarted, setGameStarted] = useState(false);
  
  // Estados do jogo
  const [whiteTime, setWhiteTime] = useState(0);
  const [blackTime, setBlackTime] = useState(0);
  const [activePlayer, setActivePlayer] = useState(null); // 'white' ou 'black'
  const [isPaused, setIsPaused] = useState(false);
  const [gameOver, setGameOver] = useState(null); // 'white' ou 'black'
  
  const intervalRef = useRef(null);
  const lastBeepRef = useRef(null);

  // Força orientação horizontal e tela cheia
  useEffect(() => {
    const lockOrientation = async () => {
      try {
        if (screen.orientation && screen.orientation.lock) {
          await screen.orientation.lock('landscape');
        }
      } catch (err) {
        console.log('Orientation lock not supported');
      }
    };

    const requestFullscreen = () => {
      const elem = document.documentElement;
      if (elem.requestFullscreen) {
        elem.requestFullscreen();
      } else if (elem.webkitRequestFullscreen) {
        elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) {
        elem.msRequestFullscreen();
      }
    };

    lockOrientation();
    
    const timer = setTimeout(() => {
      requestFullscreen();
    }, 100);

    return () => clearTimeout(timer);
  }, []);

  // Sons
  const playClickSound = () => {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.frequency.value = 800;
    oscillator.type = 'sine';
    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
    
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.1);
  };

  const playCountdownBeep = () => {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.frequency.value = 1200;
    oscillator.type = 'square';
    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
    
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.15);
  };

  const vibrate = () => {
    if (navigator.vibrate) {
      navigator.vibrate([200, 100, 200, 100, 200]);
    }
  };

  // Timer principal
  useEffect(() => {
    if (activePlayer && !isPaused && !gameOver) {
      intervalRef.current = setInterval(() => {
        if (activePlayer === 'white') {
          setWhiteTime(prev => {
            const newTime = prev - 1;
            
            // Beep nos últimos 5 segundos
            if (newTime <= 5 && newTime > 0) {
              playCountdownBeep();
            }
            
            // Tempo esgotado
            if (newTime <= 0) {
              setGameOver('white');
              vibrate();
              clearInterval(intervalRef.current);
              return 0;
            }
            
            return newTime;
          });
        } else {
          setBlackTime(prev => {
            const newTime = prev - 1;
            
            // Beep nos últimos 5 segundos
            if (newTime <= 5 && newTime > 0) {
              playCountdownBeep();
            }
            
            // Tempo esgotado
            if (newTime <= 0) {
              setGameOver('black');
              vibrate();
              clearInterval(intervalRef.current);
              return 0;
            }
            
            return newTime;
          });
        }
      }, 1000);
    }

    return () => {
      if (intervalRef.current) {
        clearInterval(intervalRef.current);
      }
    };
  }, [activePlayer, isPaused, gameOver]);

  const timeOptions = {
    bullet: [
      { label: '1 min', value: 60 },
      { label: '2 min', value: 120 }
    ],
    blitz: [
      { label: '3 min', value: 180 },
      { label: '5 min', value: 300 }
    ],
    rapid: [
      { label: '10 min', value: 600 },
      { label: '15 min', value: 900 },
      { label: '30 min', value: 1800 }
    ]
  };

  const incrementOptions = [
    { label: '1 seg', value: 1 },
    { label: '2 seg', value: 2 },
    { label: '5 seg', value: 5 },
    { label: '10 seg', value: 10 }
  ];

  const handleTimeSelect = (time) => {
    setSelectedTime(time);
  };

  const handleIncrementSelect = (increment) => {
    setSelectedIncrement(increment);
  };

  const handleStartGame = () => {
    if (selectedTime) {
      setWhiteTime(selectedTime);
      setBlackTime(selectedTime);
      setGameStarted(true);
      setActivePlayer(null);
      setIsPaused(false);
      setGameOver(null);
    }
  };

  const handleTimerClick = (player) => {
    if (gameOver || isPaused || activePlayer === null) return;
    
    // Som só toca se apertar o timer que está ATIVO (em contagem)
    if (activePlayer === player) {
      playClickSound();
      
      // Adicionar incremento
      if (incrementEnabled && selectedIncrement) {
        if (player === 'white') {
          setWhiteTime(prev => prev + selectedIncrement);
        } else {
          setBlackTime(prev => prev + selectedIncrement);
        }
      }
      
      // Trocar jogador
      setActivePlayer(player === 'white' ? 'black' : 'white');
    }
  };

  const handlePlay = () => {
    if (activePlayer === null) {
      setActivePlayer('white');
    }
    setIsPaused(false);
  };

  const handlePause = () => {
    setIsPaused(true);
  };

  const handleReset = () => {
    setWhiteTime(selectedTime);
    setBlackTime(selectedTime);
    setActivePlayer(null);
    setIsPaused(false);
    setGameOver(null);
  };

  const handleBackToHome = () => {
    setGameStarted(false);
    setSelectedTime(null);
    setSelectedIncrement(null);
    setActivePlayer(null);
    setIsPaused(false);
    setGameOver(null);
  };

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  };

  if (!gameStarted) {
    return (
      <div className="min-h-screen bg-white flex items-center justify-center p-2 overflow-auto">
        <div className="w-full max-w-7xl">
          {/* Header Compacto - Sem Ícone */}
          <div className="text-center mb-2">
            <h1 className="texto-titulo font-bold text-black leading-tight">Relógio Digital para Xadrez</h1>
            <p className="texto-subtitulo text-gray-600">Criado por Humberto Lima com claude.ai</p>
          </div>

          {/* Layout em 2 Colunas */}
          <div className="grid grid-cols-2 gap-4">
            {/* Coluna Esquerda - Categorias de Tempo */}
            <div className="space-y-2">
              {/* Bullet */}
              <div>
                <h2 className="texto-categoria font-semibold text-black mb-1 text-center">Bullet</h2>
                <div className="flex gap-2">
                  {timeOptions.bullet.map((option) => (
                    <button
                      key={option.value}
                      onClick={() => handleTimeSelect(option.value)}
                      className={`flex-1 botao-tempo rounded-lg font-medium transition-all border-2 ${
                        selectedTime === option.value
                          ? 'bg-black text-white border-black'
                          : 'bg-white text-black border-gray-300 hover:border-black'
                      }`}
                    >
                      {option.label}
                    </button>
                  ))}
                </div>
              </div>

              {/* Blitz */}
              <div>
                <h2 className="texto-categoria font-semibold text-black mb-1 text-center">Blitz</h2>
                <div className="flex gap-2">
                  {timeOptions.blitz.map((option) => (
                    <button
                      key={option.value}
                      onClick={() => handleTimeSelect(option.value)}
                      className={`flex-1 botao-tempo rounded-lg font-medium transition-all border-2 ${
                        selectedTime === option.value
                          ? 'bg-black text-white border-black'
                          : 'bg-white text-black border-gray-300 hover:border-black'
                      }`}
                    >
                      {option.label}
                    </button>
                  ))}
                </div>
              </div>

              {/* Rápido */}
              <div>
                <h2 className="texto-categoria font-semibold text-black mb-1 text-center">Rápido</h2>
                <div className="grid grid-cols-3 gap-2">
                  {timeOptions.rapid.map((option) => (
                    <button
                      key={option.value}
                      onClick={() => handleTimeSelect(option.value)}
                      className={`botao-tempo rounded-lg font-medium transition-all border-2 ${
                        selectedTime === option.value
                          ? 'bg-black text-white border-black'
                          : 'bg-white text-black border-gray-300 hover:border-black'
                      }`}
                    >
                      {option.label}
                    </button>
                  ))}
                </div>
              </div>
            </div>

            {/* Coluna Direita - Acréscimos e Iniciar */}
            <div className="flex flex-col justify-between gap-2">
              {/* Acréscimos */}
              <div className="border-2 border-gray-300 rounded-lg p-3">
                <div className="flex items-center justify-between mb-3">
                  <h2 className="texto-categoria font-semibold text-black">Acréscimos</h2>
                  <button
                    onClick={() => {
                      setIncrementEnabled(!incrementEnabled);
                      if (incrementEnabled) setSelectedIncrement(null);
                    }}
                    className={`relative inline-flex h-7 w-14 items-center rounded-full transition-colors border-2 ${
                      incrementEnabled ? 'bg-black border-black' : 'bg-white border-gray-300'
                    }`}
                  >
                    <span
                      className={`inline-block h-5 w-5 transform rounded-full transition-transform ${
                        incrementEnabled ? 'translate-x-8 bg-white' : 'translate-x-1 bg-black'
                      }`}
                    />
                  </button>
                </div>

                {incrementEnabled && (
                  <div className="grid grid-cols-2 gap-2">
                    {incrementOptions.map((option) => (
                      <button
                        key={option.value}
                        onClick={() => handleIncrementSelect(option.value)}
                        className={`botao-tempo rounded-lg font-medium transition-all border-2 ${
                          selectedIncrement === option.value
                            ? 'bg-black text-white border-black'
                            : 'bg-white text-black border-gray-300 hover:border-black'
                        }`}
                      >
                        {option.label}
                      </button>
                    ))}
                  </div>
                )}
              </div>

              {/* Configuração e Botão Iniciar */}
              <div className="space-y-3">
                {selectedTime && (
                  <>
                    <div className="border-2 border-black rounded-lg p-3 bg-white text-center">
                      <p className="texto-subtitulo text-gray-600 uppercase tracking-wider mb-1">Configuração Selecionada</p>
                      <p className="text-black font-bold" style={{fontSize: '1rem'}}>
                        {Math.floor(selectedTime / 60)} minutos
                        {incrementEnabled && selectedIncrement && (
                          <span className="text-gray-600"> + {selectedIncrement} seg</span>
                        )}
                      </p>
                    </div>
                    
                    <button
                      onClick={handleStartGame}
                      className="w-full botao-iniciar bg-black text-white rounded-lg font-bold hover:bg-gray-800 transition-colors"
                    >
                      Iniciar Partida
                    </button>
                  </>
                )}
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  }
  // Página do Jogo
  return (
    <div className="min-h-screen bg-white flex items-center justify-center p-4">
      <div className="max-w-7xl w-full h-screen flex flex-col justify-between py-4">
        
        {/* Timers */}
        <div className="flex-1 flex gap-4">
          {/* Timer Pretas (Esquerda) - Cores Invertidas */}
          <button
            onClick={() => handleTimerClick('black')}
            disabled={gameOver !== null}
            className={`flex-1 rounded-lg border-4 flex flex-col items-center justify-center transition-all relative overflow-hidden ${
              activePlayer === 'black' 
                ? 'border-blue-400 bg-blue-900' 
                : 'border-gray-600 bg-black'
            } ${gameOver ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer hover:border-gray-500'}`}
          >
            {/* Efeito de iluminação */}
            {activePlayer === 'black' && (
              <div className="absolute inset-0 bg-gradient-to-br from-blue-400 via-blue-600 to-transparent opacity-40 animate-pulse"></div>
            )}
            
            <div className="relative z-10">
              <p className="timer-label font-semibold text-gray-300 mb-2">PRETAS</p>
              <p className={`timer-texto font-bold ${
                blackTime <= 5 && blackTime > 0 ? 'text-red-500' : 'text-white'
              }`}>
                {formatTime(blackTime)}
              </p>
            </div>
          </button>

          {/* Timer Brancas (Direita) */}
          <button
            onClick={() => handleTimerClick('white')}
            disabled={gameOver !== null}
            className={`flex-1 rounded-lg border-4 flex flex-col items-center justify-center transition-all relative overflow-hidden ${
              activePlayer === 'white' 
                ? 'border-blue-400 bg-blue-50' 
                : 'border-gray-300 bg-gray-50'
            } ${gameOver ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer hover:border-gray-400'}`}
          >
            {/* Efeito de iluminação */}
            {activePlayer === 'white' && (
              <div className="absolute inset-0 bg-gradient-to-br from-blue-200 via-blue-100 to-transparent opacity-50 animate-pulse"></div>
            )}
            
            <div className="relative z-10">
              <p className="timer-label font-semibold text-gray-600 mb-2">BRANCAS</p>
              <p className={`timer-texto font-bold ${
                whiteTime <= 5 && whiteTime > 0 ? 'text-red-600' : 'text-black'
              }`}>
                {formatTime(whiteTime)}
              </p>
            </div>
          </button>
        </div>

        {/* Mensagem de Game Over */}
        {gameOver && (
          <div className="absolute inset-0 flex items-end justify-center pb-32 bg-black bg-opacity-50 z-50">
            <div className="bg-white p-12 rounded-lg text-center shadow-2xl">
              <p className="text-5xl font-bold text-black mb-8">
                O tempo das {gameOver === 'white' ? 'BRANCAS' : 'PRETAS'} se esgotou
              </p>
              <button
                onClick={handleBackToHome}
                className="bg-black text-white px-12 py-4 rounded-lg text-xl font-semibold hover:bg-gray-800 transition-colors"
              >
                Voltar à Tela Inicial
              </button>
            </div>
          </div>
        )}

        {/* Controles */}
        <div className="flex justify-center gap-4 mt-4">
          {/* Play */}
          <div className="relative group">
            <button
              onClick={handlePlay}
              disabled={activePlayer !== null && !isPaused}
              className="w-14 h-14 botao-redondo rounded-full bg-black text-white hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
              title="Play"
            >
              <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                <path d="M8 5v14l11-7z"/>
              </svg>
            </button>
            {/* Tooltip */}
            {activePlayer === null && !gameOver && (
              <div className="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-4 py-2 bg-black text-white text-sm rounded-lg whitespace-nowrap">
                O jogador de pretas aciona para começar.
                <div className="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-black"></div>
              </div>
            )}
          </div>
          
          {/* Pause */}
          <button
            onClick={handlePause}
            disabled={isPaused || activePlayer === null}
            className="w-14 h-14 botao-redondo rounded-full bg-black text-white hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
            title="Pausa"
          >
            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
              <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
            </svg>
          </button>
          
          {/* Reiniciar */}
          <button
            onClick={handleReset}
            className="w-14 h-14 botao-redondo rounded-full bg-black text-white hover:bg-gray-800 transition-colors flex items-center justify-center"
            title="Reiniciar"
          >
            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
              <path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>
            </svg>
          </button>
          
          {/* Voltar */}
          <button
            onClick={handleBackToHome}
            className="w-14 h-14 botao-redondo rounded-full bg-gray-600 text-white hover:bg-gray-700 transition-colors flex items-center justify-center"
            title="Voltar"
          >
            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  );
}

    const { useState, useEffect, useRef } = React;
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ChessClock />);
  </script>
</body>
</html>
