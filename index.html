<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#ffffff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Relógio de Xadrez</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React e Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    * {
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      user-select: none;
      -webkit-user-select: none;
    }
    
    #root {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">


function ChessClock() {
  const [incrementEnabled, setIncrementEnabled] = useState(false);
  const [selectedTime, setSelectedTime] = useState(null);
  const [selectedIncrement, setSelectedIncrement] = useState(null);
  const [gameStarted, setGameStarted] = useState(false);
  
  // Estados do jogo
  const [whiteTime, setWhiteTime] = useState(0);
  const [blackTime, setBlackTime] = useState(0);
  const [activePlayer, setActivePlayer] = useState(null); // 'white' ou 'black'
  const [isPaused, setIsPaused] = useState(false);
  const [gameOver, setGameOver] = useState(null); // 'white' ou 'black'
  
  const intervalRef = useRef(null);
  const lastBeepRef = useRef(null);

  // Força orientação horizontal e tela cheia
  useEffect(() => {
    const lockOrientation = async () => {
      try {
        if (screen.orientation && screen.orientation.lock) {
          await screen.orientation.lock('landscape');
        }
      } catch (err) {
        console.log('Orientation lock not supported');
      }
    };

    const requestFullscreen = () => {
      const elem = document.documentElement;
      if (elem.requestFullscreen) {
        elem.requestFullscreen();
      } else if (elem.webkitRequestFullscreen) {
        elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) {
        elem.msRequestFullscreen();
      }
    };

    lockOrientation();
    
    const timer = setTimeout(() => {
      requestFullscreen();
    }, 100);

    return () => clearTimeout(timer);
  }, []);

  // Sons
  const playClickSound = () => {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.frequency.value = 800;
    oscillator.type = 'sine';
    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
    
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.1);
  };

  const playCountdownBeep = () => {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.frequency.value = 1200;
    oscillator.type = 'square';
    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
    
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.15);
  };

  const vibrate = () => {
    if (navigator.vibrate) {
      navigator.vibrate([200, 100, 200, 100, 200]);
    }
  };

  // Timer principal
  useEffect(() => {
    if (activePlayer && !isPaused && !gameOver) {
      intervalRef.current = setInterval(() => {
        if (activePlayer === 'white') {
          setWhiteTime(prev => {
            const newTime = prev - 1;
            
            // Beep nos últimos 5 segundos
            if (newTime <= 5 && newTime > 0) {
              playCountdownBeep();
            }
            
            // Tempo esgotado
            if (newTime <= 0) {
              setGameOver('white');
              vibrate();
              clearInterval(intervalRef.current);
              return 0;
            }
            
            return newTime;
          });
        } else {
          setBlackTime(prev => {
            const newTime = prev - 1;
            
            // Beep nos últimos 5 segundos
            if (newTime <= 5 && newTime > 0) {
              playCountdownBeep();
            }
            
            // Tempo esgotado
            if (newTime <= 0) {
              setGameOver('black');
              vibrate();
              clearInterval(intervalRef.current);
              return 0;
            }
            
            return newTime;
          });
        }
      }, 1000);
    }

    return () => {
      if (intervalRef.current) {
        clearInterval(intervalRef.current);
      }
    };
  }, [activePlayer, isPaused, gameOver]);

  const timeOptions = {
    bullet: [
      { label: '1 min', value: 60 },
      { label: '2 min', value: 120 }
    ],
    blitz: [
      { label: '3 min', value: 180 },
      { label: '5 min', value: 300 }
    ],
    rapid: [
      { label: '10 min', value: 600 },
      { label: '15 min', value: 900 },
      { label: '30 min', value: 1800 }
    ]
  };

  const incrementOptions = [
    { label: '1 seg', value: 1 },
    { label: '2 seg', value: 2 },
    { label: '5 seg', value: 5 },
    { label: '10 seg', value: 10 }
  ];

  const handleTimeSelect = (time) => {
    setSelectedTime(time);
  };

  const handleIncrementSelect = (increment) => {
    setSelectedIncrement(increment);
  };

  const handleStartGame = () => {
    if (selectedTime) {
      setWhiteTime(selectedTime);
      setBlackTime(selectedTime);
      setGameStarted(true);
      setActivePlayer(null);
      setIsPaused(false);
      setGameOver(null);
    }
  };

  const handleTimerClick = (player) => {
    if (gameOver || isPaused || activePlayer === null) return;
    
    // Som só toca se apertar o timer que está ATIVO (em contagem)
    if (activePlayer === player) {
      playClickSound();
      
      // Adicionar incremento
      if (incrementEnabled && selectedIncrement) {
        if (player === 'white') {
          setWhiteTime(prev => prev + selectedIncrement);
        } else {
          setBlackTime(prev => prev + selectedIncrement);
        }
      }
      
      // Trocar jogador
      setActivePlayer(player === 'white' ? 'black' : 'white');
    }
  };

  const handlePlay = () => {
    if (activePlayer === null) {
      setActivePlayer('white');
    }
    setIsPaused(false);
  };

  const handlePause = () => {
    setIsPaused(true);
  };

  const handleReset = () => {
    setWhiteTime(selectedTime);
    setBlackTime(selectedTime);
    setActivePlayer(null);
    setIsPaused(false);
    setGameOver(null);
  };

  const handleBackToHome = () => {
    setGameStarted(false);
    setSelectedTime(null);
    setSelectedIncrement(null);
    setActivePlayer(null);
    setIsPaused(false);
    setGameOver(null);
  };

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  };

  if (!gameStarted) {
    return (
      <div className="min-h-screen bg-white flex items-center justify-center p-4">
        <div className="max-w-6xl w-full">
          {/* Header */}
          <div className="text-center mb-6">
            {/* Logo Peão */}
            <div className="flex justify-center mb-3">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="5" r="2" fill="black"/>
                <path d="M10 7 C10 7, 9 8, 9 10 L9 14 L8 14 L7 20 L17 20 L16 14 L15 14 L15 10 C15 8, 14 7, 14 7" 
                      fill="black" stroke="black" strokeWidth="1" strokeLinejoin="round"/>
                <rect x="6" y="20" width="12" height="2" rx="1" fill="black"/>
              </svg>
            </div>
            <h1 className="text-3xl font-bold text-black mb-1 tracking-tight">
              Relógio Digital para Xadrez
            </h1>
            <p className="text-gray-600 text-sm">
              Criado por Humberto Lima com claude.ai
            </p>
          </div>

          {/* Controles de Tempo - Centralizado */}
          <div className="max-w-4xl mx-auto space-y-5">
            {/* Bullet */}
            <div>
              <h2 className="text-lg font-semibold text-black mb-2 text-center">Bullet</h2>
              <div className="flex justify-center gap-3">
                {timeOptions.bullet.map((option) => (
                  <button
                    key={option.value}
                    onClick={() => handleTimeSelect(option.value)}
                    className={`py-3 px-8 rounded-lg text-base font-medium transition-all border-2 ${
                      selectedTime === option.value
                        ? 'bg-black text-white border-black'
                        : 'bg-white text-black border-gray-300 hover:border-black'
                    }`}
                  >
                    {option.label}
                  </button>
                ))}
              </div>
            </div>

            {/* Blitz */}
            <div>
              <h2 className="text-lg font-semibold text-black mb-2 text-center">Blitz</h2>
              <div className="flex justify-center gap-3">
                {timeOptions.blitz.map((option) => (
                  <button
                    key={option.value}
                    onClick={() => handleTimeSelect(option.value)}
                    className={`py-3 px-8 rounded-lg text-base font-medium transition-all border-2 ${
                      selectedTime === option.value
                        ? 'bg-black text-white border-black'
                        : 'bg-white text-black border-gray-300 hover:border-black'
                    }`}
                  >
                    {option.label}
                  </button>
                ))}
              </div>
            </div>

            {/* Rápido */}
            <div>
              <h2 className="text-lg font-semibold text-black mb-2 text-center">Rápido</h2>
              <div className="flex justify-center gap-3 flex-wrap">
                {timeOptions.rapid.map((option) => (
                  <button
                    key={option.value}
                    onClick={() => handleTimeSelect(option.value)}
                    className={`py-3 px-8 rounded-lg text-base font-medium transition-all border-2 ${
                      selectedTime === option.value
                        ? 'bg-black text-white border-black'
                        : 'bg-white text-black border-gray-300 hover:border-black'
                    }`}
                  >
                    {option.label}
                  </button>
                ))}
              </div>
            </div>

            {/* Toggle de Acréscimos */}
            <div className="border-2 border-gray-300 rounded-lg p-4 max-w-2xl mx-auto">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-lg font-semibold text-black">Acréscimos</h2>
                <button
                  onClick={() => {
                    setIncrementEnabled(!incrementEnabled);
                    if (incrementEnabled) setSelectedIncrement(null);
                  }}
                  className={`relative inline-flex h-8 w-16 items-center rounded-full transition-colors border-2 ${
                    incrementEnabled ? 'bg-black border-black' : 'bg-white border-gray-300'
                  }`}
                >
                  <span
                    className={`inline-block h-6 w-6 transform rounded-full transition-transform ${
                      incrementEnabled ? 'translate-x-9 bg-white' : 'translate-x-1 bg-black'
                    }`}
                  />
                </button>
              </div>

              {/* Opções de Acréscimo */}
              {incrementEnabled && (
                <div className="flex justify-center gap-3 flex-wrap">
                  {incrementOptions.map((option) => (
                    <button
                      key={option.value}
                      onClick={() => handleIncrementSelect(option.value)}
                      className={`py-3 px-6 rounded-lg text-base font-medium transition-all border-2 ${
                        selectedIncrement === option.value
                          ? 'bg-black text-white border-black'
                          : 'bg-white text-black border-gray-300 hover:border-black'
                      }`}
                    >
                      {option.label}
                    </button>
                  ))}
                </div>
              )}
            </div>

            {/* Indicador de Seleção e Botão Iniciar */}
            {selectedTime && (
              <div className="flex items-center justify-center gap-8 mt-6">
                <div className="border-2 border-black rounded-lg p-4 bg-white">
                  <p className="text-gray-600 text-xs mb-1 uppercase tracking-wider">Configuração selecionada</p>
                  <p className="text-black text-xl font-bold">
                    {Math.floor(selectedTime / 60)} minutos
                    {incrementEnabled && selectedIncrement && (
                      <span className="text-gray-600"> + {selectedIncrement} seg</span>
                    )}
                  </p>
                </div>
                
                <button
                  onClick={handleStartGame}
                  className="bg-black text-white px-12 py-4 rounded-lg text-xl font-bold hover:bg-gray-800 transition-colors"
                >
                  Iniciar Partida
                </button>
              </div>
            )}
          </div>
        </div>
      </div>
    );
  }

  // Página do Jogo
  return (
    <div className="min-h-screen bg-white flex items-center justify-center p-4">
      <div className="max-w-7xl w-full h-screen flex flex-col justify-between py-4">
        
        {/* Timers */}
        <div className="flex-1 flex gap-4">
          {/* Timer Pretas (Esquerda) - Cores Invertidas */}
          <button
            onClick={() => handleTimerClick('black')}
            disabled={gameOver !== null}
            className={`flex-1 rounded-lg border-4 flex flex-col items-center justify-center transition-all relative overflow-hidden ${
              activePlayer === 'black' 
                ? 'border-blue-400 bg-blue-900' 
                : 'border-gray-600 bg-black'
            } ${gameOver ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer hover:border-gray-500'}`}
          >
            {/* Efeito de iluminação */}
            {activePlayer === 'black' && (
              <div className="absolute inset-0 bg-gradient-to-br from-blue-400 via-blue-600 to-transparent opacity-40 animate-pulse"></div>
            )}
            
            <div className="relative z-10">
              <p className="text-sm font-semibold text-gray-300 mb-2">PRETAS</p>
              <p className={`text-8xl font-bold ${
                blackTime <= 5 && blackTime > 0 ? 'text-red-500' : 'text-white'
              }`}>
                {formatTime(blackTime)}
              </p>
            </div>
          </button>

          {/* Timer Brancas (Direita) */}
          <button
            onClick={() => handleTimerClick('white')}
            disabled={gameOver !== null}
            className={`flex-1 rounded-lg border-4 flex flex-col items-center justify-center transition-all relative overflow-hidden ${
              activePlayer === 'white' 
                ? 'border-blue-400 bg-blue-50' 
                : 'border-gray-300 bg-gray-50'
            } ${gameOver ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer hover:border-gray-400'}`}
          >
            {/* Efeito de iluminação */}
            {activePlayer === 'white' && (
              <div className="absolute inset-0 bg-gradient-to-br from-blue-200 via-blue-100 to-transparent opacity-50 animate-pulse"></div>
            )}
            
            <div className="relative z-10">
              <p className="text-sm font-semibold text-gray-600 mb-2">BRANCAS</p>
              <p className={`text-8xl font-bold ${
                whiteTime <= 5 && whiteTime > 0 ? 'text-red-600' : 'text-black'
              }`}>
                {formatTime(whiteTime)}
              </p>
            </div>
          </button>
        </div>

        {/* Mensagem de Game Over */}
        {gameOver && (
          <div className="absolute inset-0 flex items-end justify-center pb-32 bg-black bg-opacity-50 z-50">
            <div className="bg-white p-12 rounded-lg text-center shadow-2xl">
              <p className="text-5xl font-bold text-black mb-8">
                O tempo das {gameOver === 'white' ? 'BRANCAS' : 'PRETAS'} se esgotou
              </p>
              <button
                onClick={handleBackToHome}
                className="bg-black text-white px-12 py-4 rounded-lg text-xl font-semibold hover:bg-gray-800 transition-colors"
              >
                Voltar à Tela Inicial
              </button>
            </div>
          </div>
        )}

        {/* Controles */}
        <div className="flex justify-center gap-4 mt-4">
          <div className="relative group">
            <button
              onClick={handlePlay}
              disabled={activePlayer !== null && !isPaused}
              className="bg-black text-white px-8 py-3 rounded-lg font-semibold hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              ▶ Play
            </button>
            {/* Tooltip */}
            {activePlayer === null && !gameOver && (
              <div className="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-4 py-2 bg-black text-white text-sm rounded-lg whitespace-nowrap">
                O jogador de pretas aciona para começar.
                <div className="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-black"></div>
              </div>
            )}
          </div>
          
          <button
            onClick={handlePause}
            disabled={isPaused || activePlayer === null}
            className="bg-black text-white px-8 py-3 rounded-lg font-semibold hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          >
            ⏸ Pausa
          </button>
          
          <button
            onClick={handleReset}
            className="bg-black text-white px-8 py-3 rounded-lg font-semibold hover:bg-gray-800 transition-colors"
          >
            ↻ Reiniciar
          </button>
          
          <button
            onClick={handleBackToHome}
            className="bg-gray-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-gray-700 transition-colors"
          >
            ← Voltar
          </button>
        </div>
      </div>
    </div>
  );
}

    const { useState, useEffect, useRef } = React;
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ChessClock />);
  </script>
</body>
</html>
